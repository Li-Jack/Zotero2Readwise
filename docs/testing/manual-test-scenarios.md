# Manual Testing Scenarios

## 测试环境准备

### 前置条件
1. 安装 Zotero 7.0+
2. 安装 Z2R 插件开发版本
3. 准备 Readwise 测试账号和 API Token
4. 准备测试文献（PDF）和注释

### 测试数据集
- 小数据集：5-10 个注释
- 中等数据集：50-100 个注释  
- 大数据集：500+ 个注释
- 混合数据集：包含高亮、笔记、多种颜色

---

## 1. 基础功能测试

### 1.1 仅高亮同步
**测试步骤：**
1. 在 Zotero 中创建 5 个纯高亮注释（无笔记）
2. 选择不同颜色：黄色、红色、绿色、蓝色、紫色
3. 执行同步操作
4. 验证 Readwise 中的高亮内容

**预期结果：**
- ✅ 所有高亮正确同步
- ✅ 颜色映射正确（如启用）
- ✅ 无重复项
- ✅ 元数据完整（标题、作者、页码）

### 1.2 仅笔记同步
**测试步骤：**
1. 创建 5 个带评论的笔记（无高亮文本）
2. 包含长文本、短文本、特殊字符
3. 执行同步操作
4. 验证 Readwise 中的笔记内容

**预期结果：**
- ✅ 笔记内容完整同步
- ✅ 特殊字符正确处理
- ✅ 长文本不被截断

### 1.3 混合内容同步
**测试步骤：**
1. 创建混合注释集：
   - 3 个纯高亮
   - 3 个纯笔记
   - 4 个高亮+笔记组合
2. 执行同步操作
3. 验证所有内容

**预期结果：**
- ✅ 不同类型正确识别和同步
- ✅ 组合注释的高亮和笔记都保留
- ✅ 顺序保持一致

---

## 2. 颜色映射测试

### 2.1 颜色映射开启
**测试步骤：**
1. 在设置中启用颜色映射
2. 配置映射规则：
   - #ffd400 → yellow
   - #ff6666 → red
   - #5fb236 → green
   - #2ea8e5 → blue
   - #a28ae5 → purple
3. 创建各种颜色的高亮
4. 同步并验证

**预期结果：**
- ✅ 颜色按映射规则转换
- ✅ 未映射颜色使用默认值
- ✅ Readwise 中显示正确颜色

### 2.2 颜色映射关闭
**测试步骤：**
1. 禁用颜色映射
2. 创建带颜色的高亮
3. 同步并验证

**预期结果：**
- ✅ 颜色信息被忽略或使用默认
- ✅ 同步正常完成

---

## 3. 错误处理与恢复

### 3.1 网络断开测试
**测试步骤：**
1. 准备 20 个注释
2. 开始同步
3. 同步过程中断开网络
4. 恢复网络后重试

**预期结果：**
- ✅ 显示网络错误提示
- ✅ 支持手动重试
- ✅ 已同步项不重复
- ✅ 从断点继续

### 3.2 API 超时测试
**测试步骤：**
1. 使用网络限速工具模拟慢速连接
2. 准备大量注释（100+）
3. 执行同步
4. 观察超时处理

**预期结果：**
- ✅ 超时后自动重试
- ✅ 显示进度信息
- ✅ 最终完成或明确失败

### 3.3 429 速率限制测试
**测试步骤：**
1. 快速连续执行多次同步
2. 或一次同步大量数据（500+）
3. 触发 Readwise API 速率限制

**预期结果：**
- ✅ 检测到 429 错误
- ✅ 遵守 Retry-After 头部
- ✅ 自动延迟后重试
- ✅ 显示等待提示

### 3.4 认证失败测试
**测试步骤：**
1. 使用无效的 API Token
2. 尝试执行同步
3. 使用过期的 Token
4. 尝试执行同步

**预期结果：**
- ✅ 清晰的认证错误提示
- ✅ 引导用户更新 Token
- ✅ 不会无限重试

---

## 4. 增量同步测试

### 4.1 首次全量同步
**测试步骤：**
1. 清空同步历史
2. 准备 50 个历史注释
3. 执行首次同步
4. 验证所有内容

**预期结果：**
- ✅ 所有注释被同步
- ✅ 记录同步时间戳
- ✅ 建立基线状态

### 4.2 增量更新同步
**测试步骤：**
1. 完成首次同步
2. 新增 5 个注释
3. 修改 3 个已有注释
4. 删除 2 个注释
5. 执行增量同步

**预期结果：**
- ✅ 仅同步新增和修改的项
- ✅ 删除的项正确处理
- ✅ 未修改项不重复同步
- ✅ 同步时间大幅缩短

### 4.3 长时间间隔同步
**测试步骤：**
1. 执行首次同步
2. 等待 7 天以上
3. 期间添加大量注释（100+）
4. 执行增量同步

**预期结果：**
- ✅ 正确识别时间范围
- ✅ 所有新注释被同步
- ✅ 性能表现良好

---

## 5. 插件重装测试

### 5.1 状态迁移测试
**测试步骤：**
1. 完成一次完整同步
2. 记录同步状态
3. 卸载插件
4. 重新安装插件
5. 执行同步

**预期结果：**
- ✅ 识别已同步项
- ✅ 不产生重复
- ✅ 继续增量同步
- ✅ 状态数据完整

### 5.2 版本升级测试
**测试步骤：**
1. 安装旧版本插件
2. 执行同步建立数据
3. 升级到新版本
4. 验证兼容性

**预期结果：**
- ✅ 数据格式兼容
- ✅ 设置保留
- ✅ 同步历史保留
- ✅ 无需重新配置

---

## 6. 性能压力测试

### 6.1 大批量同步
**测试步骤：**
1. 准备 1000+ 注释
2. 执行同步
3. 监控内存使用
4. 记录完成时间

**预期结果：**
- ✅ 内存使用稳定（<500MB）
- ✅ 无内存泄漏
- ✅ 批次处理正常
- ✅ 完成时间合理（<5分钟）

### 6.2 并发操作测试
**测试步骤：**
1. 开始同步操作
2. 同时在 Zotero 中添加新注释
3. 同时浏览和编辑文献
4. 观察稳定性

**预期结果：**
- ✅ 同步不影响其他操作
- ✅ 无界面卡顿
- ✅ 无数据冲突
- ✅ Zotero 响应正常

### 6.3 长时间运行测试
**测试步骤：**
1. 设置自动同步（每小时）
2. 运行 24 小时
3. 期间正常使用 Zotero
4. 检查日志和性能

**预期结果：**
- ✅ 无内存累积
- ✅ 无错误累积
- ✅ 同步稳定执行
- ✅ 日志大小合理

---

## 7. 边界条件测试

### 7.1 特殊字符处理
**测试用例：**
- Emoji: 😀🎉📚
- 数学符号: ∑∫∂π
- 多语言: 中文、日文、阿拉伯文
- 特殊标点: ""''—…
- HTML/XML: <tag> & "quotes"

### 7.2 极限长度测试
**测试用例：**
- 超长高亮文本（5000+ 字符）
- 超长笔记（10000+ 字符）
- 超长标题
- 大量作者（20+）

### 7.3 空值和异常值
**测试用例：**
- 空高亮文本
- 空笔记
- 无作者文献
- 无标题文献
- 无页码注释

---

## 8. UI/UX 测试

### 8.1 进度显示
**验证点：**
- ✅ 实时进度更新
- ✅ 剩余时间估算
- ✅ 当前处理项显示
- ✅ 可以取消操作

### 8.2 错误提示
**验证点：**
- ✅ 错误信息清晰
- ✅ 提供解决建议
- ✅ 支持查看详情
- ✅ 可复制错误信息

### 8.3 设置界面
**验证点：**
- ✅ 设置项完整
- ✅ 默认值合理
- ✅ 验证输入有效性
- ✅ 设置即时生效

---

## 测试检查清单

### 基础功能 ✓
- [ ] 高亮同步
- [ ] 笔记同步
- [ ] 混合同步
- [ ] 颜色映射

### 错误处理 ✓
- [ ] 网络错误
- [ ] 超时处理
- [ ] 速率限制
- [ ] 认证失败

### 增量同步 ✓
- [ ] 首次同步
- [ ] 增量更新
- [ ] 删除处理
- [ ] 状态持久化

### 性能测试 ✓
- [ ] 大数据量
- [ ] 内存使用
- [ ] 响应时间
- [ ] 并发处理

### 兼容性 ✓
- [ ] Zotero 版本
- [ ] 操作系统
- [ ] 插件升级
- [ ] 数据迁移

---

## 问题报告模板

**问题描述：**
[详细描述问题]

**复现步骤：**
1. 
2. 
3. 

**预期行为：**
[描述预期结果]

**实际行为：**
[描述实际结果]

**环境信息：**
- Zotero 版本：
- 插件版本：
- 操作系统：
- 注释数量：

**日志信息：**
```
[粘贴相关日志]
```

**截图/录屏：**
[如有]

---

## 回归测试清单

每次发布前必须通过的测试：

1. **核心功能**
   - [ ] 基础同步工作正常
   - [ ] 增量同步正确
   - [ ] 错误恢复机制

2. **数据完整性**
   - [ ] 无数据丢失
   - [ ] 无重复同步
   - [ ] 特殊字符正确

3. **性能指标**
   - [ ] 100条注释 < 30秒
   - [ ] 内存使用 < 200MB
   - [ ] 无明显卡顿

4. **用户体验**
   - [ ] 进度显示正确
   - [ ] 错误提示清晰
   - [ ] 可以取消操作
