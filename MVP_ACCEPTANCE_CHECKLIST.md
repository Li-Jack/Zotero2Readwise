# MVP 验收清单

## 📋 验收标准和测试方法

### 1. ✅ 高亮/文字笔记采集与上传

#### 验收标准
- 能够从 Zotero PDF 阅读器中提取高亮和笔记
- 支持不同类型的注释（高亮、下划线、笔记、区域标注）
- 保留原始格式和元数据

#### 测试步骤
1. 在 Zotero 中打开 PDF 文档
2. 创建各种类型的注释：
   - 黄色高亮文字
   - 添加带评论的高亮
   - 创建独立笔记
   - 标注特定区域
3. 运行同步命令
4. 验证 Readwise 中出现对应内容

#### 验证点
- [ ] 高亮文本完整无缺
- [ ] 笔记内容正确关联
- [ ] 颜色标记正确映射
- [ ] 时间戳准确记录

---

### 2. ✅ 字段映射正确（包含深链回跳）

#### 验收标准
- Zotero 字段正确映射到 Readwise API 字段
- 深链支持从 Readwise 跳回 Zotero 原文

#### 字段映射表
| Zotero 字段 | Readwise 字段 | 说明 |
|------------|--------------|------|
| annotation.text | highlight.text | 高亮文本 |
| annotation.comment | highlight.note | 用户笔记 |
| annotation.pageLabel | highlight.location | 页码 |
| annotation.dateModified | highlight.highlighted_at | 修改时间 |
| item.title | book.title | 文献标题 |
| item.authors | book.author | 作者列表 |
| item.isbn | book.isbn | ISBN |
| item.url | book.source_url | 原始链接 |

#### 深链格式
```
zotero://select/library/items/{itemKey}
zotero://open-pdf/library/items/{itemKey}?page={pageNumber}&annotation={annotationKey}
```

#### 测试步骤
1. 创建带有完整元数据的文献条目
2. 添加注释并同步
3. 在 Readwise 中点击深链
4. 验证跳转回 Zotero 正确位置

#### 验证点
- [ ] 所有必填字段都有值
- [ ] 可选字段正确处理空值
- [ ] 深链可以正确打开 Zotero
- [ ] 定位到具体的注释位置

---

### 3. ✅ 批量上传、失败重试、速率限制

#### 验收标准
- 支持批量上传大量高亮
- 失败自动重试机制
- 遵守 API 速率限制

#### 配置参数
```javascript
{
  batchSize: 25,        // 每批数量
  maxRetries: 3,        // 最大重试次数
  retryDelay: 1000,     // 重试延迟(ms)
  rateLimit: 60,        // 每分钟请求数
  concurrency: 3        // 并发请求数
}
```

#### 测试步骤
1. 准备 100+ 条注释
2. 执行批量同步
3. 模拟网络错误
4. 观察重试行为
5. 验证速率限制

#### 验证点
- [ ] 批量上传分批进行
- [ ] 失败项目自动重试
- [ ] 不超过速率限制
- [ ] 进度条准确显示
- [ ] 部分失败不影响其他批次

---

### 4. ✅ 增量同步与去重

#### 验收标准
- 只同步新增或修改的内容
- 避免重复创建相同高亮
- 基于内容哈希的去重机制

#### 去重算法
```javascript
function generateHash(highlight) {
  const content = `${highlight.text}|${highlight.location}|${highlight.book_id}`;
  return crypto.createHash('sha256').update(content).digest('hex');
}
```

#### 测试步骤
1. 执行首次完整同步
2. 不做任何修改，再次同步
3. 添加新注释，执行增量同步
4. 修改已有注释，验证更新

#### 验证点
- [ ] 重复同步不产生重复项
- [ ] 新注释被正确识别
- [ ] 修改的注释被更新
- [ ] 删除的注释被标记
- [ ] 同步时间戳正确更新

---

### 5. ✅ UI 可用性

#### 验收标准
- Tools 菜单集成
- 进度窗口显示
- 首选项配置界面

#### UI 组件清单

##### Tools 菜单项
- Sync to Readwise (Ctrl+Alt+R)
- View Sync History
- Export Sync Report
- Settings...

##### 进度窗口
- 显示当前操作
- 实时进度条
- 处理项目计数
- 预计剩余时间
- 取消按钮

##### 首选项界面
```
┌─ Readwise Settings ─────────────────────┐
│                                          │
│ API Token: [___________________] [Test] │
│                                          │
│ Sync Options:                           │
│ ☑ Include Highlights                    │
│ ☑ Include Notes                         │
│ ☐ Include Tags                          │
│                                          │
│ Batch Size: [25 ▼]                      │
│ Auto Sync: [Every 6 hours ▼]            │
│                                          │
│ [Save] [Cancel] [Reset to Defaults]     │
└──────────────────────────────────────────┘
```

#### 测试步骤
1. 打开 Tools 菜单
2. 执行同步操作
3. 观察进度窗口
4. 打开首选项
5. 修改设置并保存

#### 验证点
- [ ] 菜单项正确显示
- [ ] 快捷键可用
- [ ] 进度窗口实时更新
- [ ] 设置可以保存和加载
- [ ] UI 响应流畅

---

### 6. ✅ 错误处理与日志

#### 验收标准
- 错误信息用户友好
- 提供恢复建议
- 日志可导出分析

#### 错误类型和处理
| 错误类型 | 用户提示 | 恢复操作 |
|---------|---------|---------|
| API Token 无效 | "请检查您的 Readwise API Token" | 打开设置界面 |
| 网络连接失败 | "无法连接到 Readwise，请检查网络" | 提供重试按钮 |
| 速率限制 | "请求过于频繁，等待 X 秒后重试" | 自动延迟重试 |
| 数据格式错误 | "某些注释格式不正确，已跳过 X 条" | 显示详情，继续处理 |

#### 日志级别
- **DEBUG**: 详细的调试信息
- **INFO**: 正常操作记录
- **WARN**: 警告但不影响运行
- **ERROR**: 错误需要处理

#### 日志导出格式
- CSV: 用于 Excel 分析
- JSON: 用于程序处理
- TXT: 用于人工阅读

#### 测试步骤
1. 触发各种错误场景
2. 验证错误提示
3. 测试恢复机制
4. 导出日志文件
5. 分析日志内容

#### 验证点
- [ ] 错误消息清晰明确
- [ ] 提供可行的解决方案
- [ ] 错误不会导致崩溃
- [ ] 日志记录完整
- [ ] 导出功能正常

---

## 🎯 验收测试执行

### 测试环境准备
1. 安装 Zotero 7.0+
2. 安装插件最新版本
3. 准备测试文献和注释
4. 获取 Readwise API Token

### 执行测试命令
```bash
# 运行单元测试
npm test

# 运行验收测试
npm run test:acceptance

# 生成测试报告
npm run test:report
```

### 性能基准
- 同步 100 条注释: < 10 秒
- 同步 1000 条注释: < 60 秒
- 内存使用: < 100MB
- CPU 使用: < 30%

---

## 📊 验收报告模板

```markdown
# MVP 验收报告

## 基本信息
- 测试日期: 2024-08-10
- 插件版本: 1.0.0
- Zotero 版本: 7.0.0
- 测试人员: [姓名]

## 功能验收结果

| 功能项 | 状态 | 备注 |
|-------|------|------|
| 高亮采集 | ✅ 通过 | |
| 笔记采集 | ✅ 通过 | |
| 字段映射 | ✅ 通过 | |
| 深链回跳 | ✅ 通过 | |
| 批量上传 | ✅ 通过 | |
| 失败重试 | ✅ 通过 | |
| 速率限制 | ✅ 通过 | |
| 增量同步 | ✅ 通过 | |
| 去重机制 | ✅ 通过 | |
| UI 菜单 | ✅ 通过 | |
| 进度显示 | ✅ 通过 | |
| 首选项 | ✅ 通过 | |
| 错误处理 | ✅ 通过 | |
| 日志导出 | ✅ 通过 | |

## 性能测试结果
- 100 条注释同步: 8.5 秒
- 1000 条注释同步: 52 秒
- 峰值内存: 78MB
- 平均 CPU: 22%

## 发现的问题
1. [如有]

## 改进建议
1. 考虑添加断点续传功能
2. 优化大文件的处理性能
3. 增加更多的同步选项

## 结论
MVP 功能全部通过验收，可以发布 Beta 版本。
```

---

## 🚀 下一步行动

1. **修复发现的问题**
   - 优先级: P0 > P1 > P2
   - 时间估算: 2-3 天

2. **准备发布**
   - 更新版本号
   - 编写发布说明
   - 准备用户文档

3. **Beta 测试**
   - 招募测试用户
   - 收集反馈
   - 迭代改进

4. **正式发布**
   - 提交到 Zotero 插件目录
   - 发布到 GitHub Releases
   - 宣传推广
