<?xml version="1.0"?>
<!DOCTYPE window SYSTEM "chrome://z2r/locale/preferences.dtd">
<prefwindow id="z2r-preferences" 
            xmlns="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
            xmlns:html="http://www.w3.org/1999/xhtml">
  
  <prefpane id="z2r-prefpane-general" label="General">
    
    <!-- API Settings -->
    <groupbox>
      <caption label="Readwise API Settings"/>
      <hbox align="center">
        <label value="API Token:" control="z2r-pref-apiToken"/>
        <textbox id="z2r-pref-apiToken" preference="pref-z2r-apiToken" type="password" flex="1"/>
        <button id="z2r-test-connection" label="Test Connection"/>
      </hbox>
    </groupbox>
    
    <!-- Sync Options -->
    <groupbox>
      <caption label="Sync Options"/>
      <vbox>
        <checkbox id="z2r-pref-syncOnStartup" 
                  preference="pref-z2r-syncOnStartup"
                  label="Sync on Zotero startup"/>
        
        <separator class="thin"/>
        
        <!-- Background Listening -->
        <checkbox id="z2r-pref-enableBackgroundSync" 
                  preference="pref-z2r-enableBackgroundSync"
                  label="Enable background listening (monitor annotation/item changes)"/>
        
        <vbox class="indent" id="z2r-background-options">
          <hbox align="center">
            <checkbox id="z2r-pref-listenToAnnotations" 
                      preference="pref-z2r-listenToAnnotations"
                      label="Listen to annotation changes"/>
          </hbox>
          <hbox align="center">
            <checkbox id="z2r-pref-listenToItems" 
                      preference="pref-z2r-listenToItems"
                      label="Listen to item changes"/>
          </hbox>
          <hbox align="center">
            <label value="Debounce delay (ms):" control="z2r-pref-annotationDebounceDelay"/>
            <textbox id="z2r-pref-annotationDebounceDelay" 
                     preference="pref-z2r-annotationDebounceDelay" 
                     type="number" 
                     min="1000" 
                     max="300000"
                     size="8"/>
            <label value="(Default: 30000ms = 30 seconds)"/>
          </hbox>
          <hbox align="center">
            <label value="Min items to trigger:" control="z2r-pref-minItemsToTriggerSync"/>
            <textbox id="z2r-pref-minItemsToTriggerSync" 
                     preference="pref-z2r-minItemsToTriggerSync" 
                     type="number" 
                     min="1" 
                     max="100"
                     size="4"/>
          </hbox>
        </vbox>
        
        <separator class="thin"/>
        
        <!-- Scheduled Sync -->
        <checkbox id="z2r-pref-enableScheduledSync" 
                  preference="pref-z2r-enableScheduledSync"
                  label="Enable scheduled sync (timer-based)"/>
        
        <hbox class="indent" align="center">
          <label value="Sync interval (minutes):" control="z2r-pref-syncIntervalMinutes"/>
          <textbox id="z2r-pref-syncIntervalMinutes" 
                   preference="pref-z2r-syncIntervalMinutes" 
                   type="number" 
                   min="5" 
                   max="1440"
                   size="6"/>
          <label value="(5-1440 minutes)"/>
        </hbox>
        
        <separator class="thin"/>
        
        <!-- Concurrency Protection -->
        <hbox align="center">
          <label value="Min sync interval (ms):" control="z2r-pref-minSyncInterval"/>
          <textbox id="z2r-pref-minSyncInterval" 
                   preference="pref-z2r-minSyncInterval" 
                   type="number" 
                   min="10000" 
                   max="600000"
                   size="8"/>
          <label value="(Prevents too frequent syncs)"/>
        </hbox>
      </vbox>
    </groupbox>
    
    <!-- Advanced Settings -->
    <groupbox>
      <caption label="Advanced Settings"/>
      <grid>
        <columns>
          <column/>
          <column flex="1"/>
        </columns>
        <rows>
          <row align="center">
            <label value="Batch size:"/>
            <textbox preference="pref-z2r-batchSize" type="number" size="6"/>
          </row>
          <row align="center">
            <label value="Rate limit (req/min):"/>
            <textbox preference="pref-z2r-rateLimit" type="number" size="6"/>
          </row>
        </rows>
      </grid>
    </groupbox>
    
  </prefpane>
  
  <!-- Define preferences -->
  <preferences>
    <preference id="pref-z2r-apiToken" name="extensions.zotero.z2r.apiToken" type="string"/>
    <preference id="pref-z2r-syncOnStartup" name="extensions.zotero.z2r.syncOnStartup" type="bool"/>
    <preference id="pref-z2r-enableBackgroundSync" name="extensions.zotero.z2r.enableBackgroundSync" type="bool"/>
    <preference id="pref-z2r-enableScheduledSync" name="extensions.zotero.z2r.enableScheduledSync" type="bool"/>
    <preference id="pref-z2r-listenToAnnotations" name="extensions.zotero.z2r.listenToAnnotations" type="bool"/>
    <preference id="pref-z2r-listenToItems" name="extensions.zotero.z2r.listenToItems" type="bool"/>
    <preference id="pref-z2r-annotationDebounceDelay" name="extensions.zotero.z2r.annotationDebounceDelay" type="int"/>
    <preference id="pref-z2r-syncIntervalMinutes" name="extensions.zotero.z2r.syncIntervalMinutes" type="int"/>
    <preference id="pref-z2r-minSyncInterval" name="extensions.zotero.z2r.minSyncInterval" type="int"/>
    <preference id="pref-z2r-minItemsToTriggerSync" name="extensions.zotero.z2r.minItemsToTriggerSync" type="int"/>
    <preference id="pref-z2r-batchSize" name="extensions.zotero.z2r.batchSize" type="int"/>
    <preference id="pref-z2r-rateLimit" name="extensions.zotero.z2r.rateLimit" type="int"/>
  </preferences>
  
</prefwindow>
