# Step 4 å®Œæˆæ€»ç»“ï¼šæ„å»ºä¸å·¥å…·é“¾é…ç½®

## âœ… å·²å®Œæˆçš„ä»»åŠ¡

### 1. TypeScript é…ç½® (tsconfig.json)
- âœ… å¼€å¯äº† strict æ¨¡å¼ï¼ŒåŒ…æ‹¬æ‰€æœ‰ä¸¥æ ¼ç±»å‹æ£€æŸ¥é€‰é¡¹
- âœ… é…ç½®äº†è·¯å¾„åˆ«åï¼ˆ@/*, @lib/*, @utils/*, @components/*, @services/*, @models/*, @config/*, @types/*ï¼‰
- âœ… è®¾ç½®äº†ç¼–è¯‘ç›®æ ‡ä¸º ES2020
- âœ… æ·»åŠ äº†é¢å¤–çš„ç¼–è¯‘æ£€æŸ¥é€‰é¡¹ï¼ˆnoUnusedLocals, noUnusedParameters, noImplicitReturnsç­‰ï¼‰

### 2. æ‰“åŒ…é…ç½® (zotero-plugin.config.ts)
- âœ… æ²¿ç”¨äº†æ¨¡æ¿çš„ esbuild é…ç½®
- âœ… äº§å‡ºå•ä¸€èƒŒæ™¯è„šæœ¬åˆ° `.scaffold/build/addon/content/scripts/`
- âœ… é›†æˆäº†ç¯å¢ƒå˜é‡æ”¯æŒï¼ˆdotenvï¼‰
- âœ… æ·»åŠ äº†æ„å»ºæ—¶å¸¸é‡æ³¨å…¥ï¼ˆ__env__, __DEBUG__, __BUILD_TARGET__, __BUILD_TIME__, __VERSION__ï¼‰
- âœ… é…ç½®äº†æ¡ä»¶ç¼–è¯‘é€‰é¡¹ï¼ˆå¼€å‘æ¨¡å¼ sourcemapï¼Œç”Ÿäº§æ¨¡å¼ minifyï¼‰
- âœ… è®¾ç½®äº† tree-shaking å’Œå…¶ä»–ä¼˜åŒ–é€‰é¡¹

### 3. ESLint é…ç½® (eslint.config.mjs)
- âœ… åŸºäº @zotero-plugin/eslint-config
- âœ… æ·»åŠ äº† TypeScript ä¸¥æ ¼è§„åˆ™
- âœ… é…ç½®äº†ä»£ç é£æ ¼è§„åˆ™ï¼ˆprefer-const, prefer-template, arrow-body-styleç­‰ï¼‰
- âœ… ä¸ºæµ‹è¯•æ–‡ä»¶è®¾ç½®äº†å®½æ¾è§„åˆ™

### 4. Prettier é…ç½®
- âœ… åˆ›å»ºäº†ç‹¬ç«‹çš„ .prettierrc é…ç½®æ–‡ä»¶
- âœ… åˆ›å»ºäº† .prettierignore æ–‡ä»¶
- âœ… è®¾ç½®äº†ç»Ÿä¸€çš„ä»£ç æ ¼å¼åŒ–è§„åˆ™

### 5. Pre-commit é’©å­
- âœ… å®‰è£…å¹¶é…ç½®äº† husky
- âœ… å®‰è£…å¹¶é…ç½®äº† lint-staged
- âœ… åˆ›å»ºäº† pre-commit hookï¼Œè‡ªåŠ¨è¿è¡Œ lint-staged
- âœ… é…ç½®äº†æ–‡ä»¶ç±»å‹å¯¹åº”çš„æ£€æŸ¥å’Œæ ¼å¼åŒ–è§„åˆ™

### 6. ç¯å¢ƒå˜é‡é…ç½®
- âœ… åˆ›å»ºäº† .env æ–‡ä»¶ï¼ˆç”¨äºæœ¬åœ°å¼€å‘ï¼‰
- âœ… æ›´æ–°äº† .env.example æ–‡ä»¶ï¼Œæä¾›å®Œæ•´çš„ç¯å¢ƒå˜é‡ç¤ºä¾‹
- âœ… .env å·²åœ¨ .gitignore ä¸­ï¼Œä¸ä¼šè¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- âœ… åˆ›å»ºäº†ç¯å¢ƒå˜é‡ç±»å‹å®šä¹‰æ–‡ä»¶ (src/types/env.d.ts)
- âœ… **é‡è¦**ï¼šAPI Token ä¸å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œè€Œæ˜¯é€šè¿‡ Zotero åå¥½è®¾ç½® UI é…ç½®

### 7. NPM Scripts
æ›´æ–°äº† package.json ä¸­çš„è„šæœ¬ï¼š
- `dev`: å¼€å‘æ¨¡å¼è¿è¡Œ
- `build`: ç”Ÿäº§æ„å»º
- `build:dev`: å¼€å‘æ„å»ºï¼ˆå¸¦ sourcemapï¼‰
- `build:prod`: ç”Ÿäº§æ„å»ºï¼ˆå‹ç¼©ï¼‰
- `typecheck`: ç±»å‹æ£€æŸ¥
- `lint`: ä»£ç æ£€æŸ¥
- `lint:fix`: è‡ªåŠ¨ä¿®å¤ä»£ç é—®é¢˜
- `format`: æ ¼å¼åŒ–ä»£ç 
- `clean`: æ¸…ç†æ„å»ºäº§ç‰©

### 8. æ„å»ºè¾…åŠ©å·¥å…·
- âœ… åˆ›å»ºäº† scripts/build-helper.mjs è¾…åŠ©è„šæœ¬
- âœ… æä¾›äº†æ¸…ç†ã€ç±»å‹æ£€æŸ¥ã€æ„å»ºä¿¡æ¯ç­‰åŠŸèƒ½

## ğŸ“ æ–°å¢/ä¿®æ”¹çš„æ–‡ä»¶

1. **é…ç½®æ–‡ä»¶**
   - ä¿®æ”¹ï¼š`tsconfig.json` - TypeScript é…ç½®
   - ä¿®æ”¹ï¼š`eslint.config.mjs` - ESLint é…ç½®
   - ä¿®æ”¹ï¼š`zotero-plugin.config.ts` - æ’ä»¶æ„å»ºé…ç½®
   - æ–°å¢ï¼š`.prettierrc` - Prettier é…ç½®
   - æ–°å¢ï¼š`.prettierignore` - Prettier å¿½ç•¥æ–‡ä»¶
   - ä¿®æ”¹ï¼š`package.json` - æ·»åŠ è„šæœ¬å’Œé…ç½®

2. **ç¯å¢ƒå˜é‡**
   - æ–°å¢ï¼š`.env` - æœ¬åœ°å¼€å‘ç¯å¢ƒå˜é‡
   - ä¿®æ”¹ï¼š`.env.example` - ç¯å¢ƒå˜é‡ç¤ºä¾‹
   - æ–°å¢ï¼š`src/types/env.d.ts` - ç¯å¢ƒå˜é‡ç±»å‹å®šä¹‰

3. **Git Hooks**
   - ä¿®æ”¹ï¼š`.husky/pre-commit` - Pre-commit hook

4. **è¾…åŠ©è„šæœ¬**
   - æ–°å¢ï¼š`scripts/build-helper.mjs` - æ„å»ºè¾…åŠ©è„šæœ¬

## ğŸ”§ å¦‚ä½•ä½¿ç”¨

### å¼€å‘æµç¨‹
```bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼
npm run dev

# ç±»å‹æ£€æŸ¥
npm run typecheck

# ä»£ç æ£€æŸ¥å’Œæ ¼å¼åŒ–
npm run lint:fix

# æ¸…ç†æ„å»ºäº§ç‰©
npm run clean
```

### æ„å»ºæµç¨‹
```bash
# å¼€å‘æ„å»ºï¼ˆå¸¦ sourcemapï¼‰
npm run build:dev

# ç”Ÿäº§æ„å»ºï¼ˆå‹ç¼©ï¼‰
npm run build:prod

# å‘å¸ƒç‰ˆæœ¬
npm run release
```

### ç¯å¢ƒå˜é‡é…ç½®
1. å¤åˆ¶ `.env.example` åˆ° `.env`
2. æ ¹æ®æœ¬åœ°ç¯å¢ƒä¿®æ”¹é…ç½®
3. **æ³¨æ„**ï¼šä¸è¦åœ¨ .env ä¸­å­˜å‚¨ API Token

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. **API Token ç®¡ç†**ï¼š
   - API Tokenï¼ˆå¦‚ Readwise Tokenï¼‰ä¸åº”å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡æ–‡ä»¶ä¸­
   - åº”é€šè¿‡ Zotero çš„åå¥½è®¾ç½® UI è¿›è¡Œé…ç½®
   - Token å°†å®‰å…¨åœ°å­˜å‚¨åœ¨ Zotero çš„åå¥½ç³»ç»Ÿä¸­

2. **ç¯å¢ƒæ–‡ä»¶**ï¼š
   - `.env` æ–‡ä»¶å·²æ·»åŠ åˆ° `.gitignore`
   - æ°¸è¿œä¸è¦æäº¤åŒ…å«æ•æ„Ÿä¿¡æ¯çš„ `.env` æ–‡ä»¶

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

æ„å»ºä¸å·¥å…·é“¾é…ç½®å·²å®Œæˆï¼Œå»ºè®®æ¥ä¸‹æ¥å¯ä»¥ï¼š
1. è¿è¡Œ `npm run lint:fix` æ ¼å¼åŒ–ç°æœ‰ä»£ç 
2. è¿è¡Œ `npm run typecheck` ç¡®ä¿ç±»å‹æ­£ç¡®
3. å¼€å§‹å®ç°æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
4. åœ¨å¼€å‘è¿‡ç¨‹ä¸­å……åˆ†åˆ©ç”¨é…ç½®çš„å·¥å…·é“¾

## ğŸ“Š é…ç½®ç‰¹ç‚¹

- **ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥**ï¼šå¼€å¯äº† TypeScript strict æ¨¡å¼
- **ç»Ÿä¸€çš„ä»£ç é£æ ¼**ï¼šESLint + Prettier è‡ªåŠ¨æ ¼å¼åŒ–
- **è‡ªåŠ¨åŒ–è´¨é‡ä¿è¯**ï¼špre-commit hooks è‡ªåŠ¨æ£€æŸ¥
- **çµæ´»çš„æ„å»ºé…ç½®**ï¼šæ”¯æŒå¼€å‘/ç”Ÿäº§ä¸åŒçš„æ„å»ºé€‰é¡¹
- **å®‰å…¨çš„é…ç½®ç®¡ç†**ï¼šæ•æ„Ÿä¿¡æ¯ä¸å­˜å‚¨åœ¨ä»£ç åº“ä¸­
